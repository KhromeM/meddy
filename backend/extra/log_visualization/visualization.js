const logData = [{"timestamp":"2024-07-08T15-28-38.961Z","query":"Hello. What's your name? ","queryLength":25,"language":"en","model":"llama3-70b-8192","llmResponse":"Hello! My name is Meddy. How can I assist you with your health or medical care today? ðŸ˜Š","llmResponseLength":88,"transcriptionLatency":719,"llmLatency":531,"ttsLatency":4515,"totalLatency":5765},{"timestamp":"2024-07-08T15-50-53.745Z","query":" Hey, Mady. What's your name? ","queryLength":30,"language":"en","model":"llama3-70b-8192","llmResponse":"Hello! My name is Meddy. How can I assist you with your health or medical care today? ðŸ˜Š","llmResponseLength":88,"transcriptionLatency":476,"llmLatency":483,"ttsLatency":3849,"totalLatency":4808},{"timestamp":"2024-07-08T15-51-16.996Z","query":" What's 2 plus 2?","queryLength":17,"language":"en","model":"llama3-70b-8192","llmResponse":"2 plus 2 equals 4. If you have any health or medical care questions, feel free to ask! ðŸ˜Š","llmResponseLength":89,"transcriptionLatency":531,"llmLatency":6460,"ttsLatency":7396,"totalLatency":14387},{"timestamp":"2024-07-08T15-51-52.186Z","query":" What's the capital of the US?","queryLength":30,"language":"en","model":"llama3-70b-8192","llmResponse":"The capital of the US is Washington, D.C. If you have any health or medical care questions, feel free to ask! ðŸ˜Š","llmResponseLength":112,"transcriptionLatency":220,"llmLatency":13499,"ttsLatency":6801,"totalLatency":20520},{"timestamp":"2024-07-08T15-52-27.029Z","query":"Who is Abraham Lincoln? ","queryLength":24,"language":"en","model":"llama3-70b-8192","llmResponse":"Abraham Lincoln was the 16th President of the United States. If you have any health or medical care questions, feel free to ask! ðŸ˜Š","llmResponseLength":131,"transcriptionLatency":910,"llmLatency":14448,"ttsLatency":3993,"totalLatency":19351},{"timestamp":"2024-07-08T15-53-10.845Z","query":"What's 5 plus 5? ","queryLength":17,"language":"en","model":"gpt-4o","llmResponse":"5 plus 5 equals 10. If you have any health or medical care questions, feel free to ask! ðŸ˜Š","llmResponseLength":90,"transcriptionLatency":514,"llmLatency":1542,"ttsLatency":1210,"totalLatency":3266},{"timestamp":"2024-07-08T15-53-23.651Z","query":"Can you ride up a","queryLength":17,"language":"en","model":"gpt-4o","llmResponse":"It seems like your message got cut off. How can I assist you with your health or medical care today? ðŸ˜Š","llmResponseLength":103,"transcriptionLatency":123,"llmLatency":818,"ttsLatency":1351,"totalLatency":2292},{"timestamp":"2024-07-08T15-53-39.139Z","query":" How fast can you run  ","queryLength":23,"language":"en","model":"gpt-4o","llmResponse":"I don't run, but I'm here to help you with any health or medical care questions you might have. How can I assist you today? ðŸ˜Š","llmResponseLength":126,"transcriptionLatency":636,"llmLatency":900,"ttsLatency":1174,"totalLatency":2710},{"timestamp":"2024-07-08T15-53-51.293Z","query":"Why don't you run","queryLength":17,"language":"en","model":"gpt-4o","llmResponse":"Iâ€™m here to assist you with your health and medical care questions. How can I help you today? ðŸ˜Š","llmResponseLength":96,"transcriptionLatency":1403,"llmLatency":1062,"ttsLatency":1617,"totalLatency":4082},{"timestamp":"2024-07-08T15-54-09.984Z","query":" Can you run today? ","queryLength":20,"language":"en","model":"gpt-4o","llmResponse":"I don't run, but I'm here to help you with any health or medical care questions you might have. How can I assist you today? ðŸ˜Š","llmResponseLength":126,"transcriptionLatency":596,"llmLatency":850,"ttsLatency":3484,"totalLatency":4930},{"timestamp":"2024-07-08T15-54-23.159Z","query":"123. ","queryLength":5,"language":"en","model":"gpt-4o","llmResponse":"It seems like your message got cut off. How can I assist you with your health or medical care today? ðŸ˜Š","llmResponseLength":103,"transcriptionLatency":873,"llmLatency":930,"ttsLatency":926,"totalLatency":2729},{"timestamp":"2024-07-08T15-54-36.299Z","query":"Â¿CÃ³mo estÃ¡s?","queryLength":12,"language":"es","model":"gpt-4o","llmResponse":"Estoy bien, gracias. Â¿Y tÃº? Â¿CÃ³mo te sientes hoy? Â¿Hay algo en lo que pueda ayudarte con respecto a tu salud? ðŸ˜Š","llmResponseLength":112,"transcriptionLatency":152,"llmLatency":1024,"ttsLatency":1500,"totalLatency":2676},{"timestamp":"2024-07-08T15-54-49.688Z","query":"Â¿CÃ³mo te llamas? ","queryLength":17,"language":"es","model":"gpt-4o","llmResponse":"Me llamo Meddy. Â¿En quÃ© puedo ayudarte con respecto a tu salud hoy? ðŸ˜Š","llmResponseLength":70,"transcriptionLatency":1059,"llmLatency":770,"ttsLatency":997,"totalLatency":2826},{"timestamp":"2024-07-08T15-58-00.464Z","query":" A gpt4. ","queryLength":9,"language":"en","model":"gpt-4o","llmResponse":"Soy Meddy, tu asistente mÃ©dico. Â¿En quÃ© puedo ayudarte con respecto a tu salud hoy? ðŸ˜Š","llmResponseLength":86,"transcriptionLatency":1097,"llmLatency":956,"ttsLatency":813,"totalLatency":2866},{"timestamp":"2024-07-08T15-58-13.054Z","query":"Can you speak English? ","queryLength":23,"language":"en","model":"gpt-4o","llmResponse":"Yes, I can speak English. How can I assist you with your health or medical care today? ðŸ˜Š","llmResponseLength":89,"transcriptionLatency":247,"llmLatency":894,"ttsLatency":826,"totalLatency":1967},{"timestamp":"2024-07-08T15-58-25.376Z","query":"Are you GPT 4","queryLength":13,"language":"en","model":"gpt-4o","llmResponse":"I'm Meddy, your medical assistant. My purpose is to help you with your health and medical care questions. How can I assist you today? ðŸ˜Š","llmResponseLength":136,"transcriptionLatency":918,"llmLatency":809,"ttsLatency":1575,"totalLatency":3302},{"timestamp":"2024-07-11T02-19-01.524Z","query":"","queryLength":0,"language":"en","model":"gpt-4o","llmResponse":"It seems like your message didn't come through. If you have any questions or need assistance with anything related to your health or medical care, please try typing them again. I'm here to help you! ðŸ˜Š","llmResponseLength":201,"transcriptionLatency":3448,"llmLatency":1169,"ttsLatency":807,"totalLatency":5424},{"timestamp":"2024-07-11T02-23-06.408Z","query":" ","queryLength":1,"language":"en","model":"gpt-4o","llmResponse":"It looks like your message didn't come through. If you have any questions or need assistance with anything related to your health or medical care, please try typing them again. I'm here to help you! ðŸ˜Š","llmResponseLength":201,"transcriptionLatency":null,"llmLatency":3400,"ttsLatency":989,"totalLatency":null},{"timestamp":"2024-07-11T02-23-24.204Z","query":" ","queryLength":1,"language":"en","model":"gpt-4o","llmResponse":"It seems like your message didn't come through. If you have any questions or need assistance with anything related to your health or medical care, please try typing them again. I'm here to help you! ðŸ˜Š","llmResponseLength":201,"transcriptionLatency":5921,"llmLatency":984,"ttsLatency":949,"totalLatency":7854},{"timestamp":"2024-07-11T02-23-47.633Z","query":"","queryLength":0,"language":"en","model":"gpt-4o","llmResponse":"Hello! My name is Meddy. How can I assist you with your health or medical care today? ðŸ˜Š","llmResponseLength":88,"transcriptionLatency":54,"llmLatency":-23884,"ttsLatency":949,"totalLatency":-22881},{"timestamp":"2024-07-11T02-23-49.349Z","query":"","queryLength":0,"language":"en","model":"gpt-4o","llmResponse":"It looks like your message didn't come through. If you have any questions or need assistance with anything related to your health or medical care, please try typing them again. I'm here to help you! ðŸ˜Š","llmResponseLength":201,"transcriptionLatency":54,"llmLatency":-23884,"ttsLatency":949,"totalLatency":-22881},{"timestamp":"2024-07-11T02-24-01.770Z","query":"What's the square root of 64?","queryLength":29,"language":"en","model":"gpt-4o","llmResponse":"The square root of 64 is 8. If you have any health or medical care questions, feel free to ask! ðŸ˜Š","llmResponseLength":98,"transcriptionLatency":152,"llmLatency":-36782,"ttsLatency":949,"totalLatency":-35681},{"timestamp":"2024-07-12T01-47-01.788Z","query":" Hey, Mehdi. What's up?   ","queryLength":26,"language":"en","model":"gpt-4o","llmResponse":"Hello! My name is Meddy. How can I assist you with your health or medical care today? ðŸ˜Š","llmResponseLength":88,"transcriptionLatency":113,"llmLatency":1322,"ttsLatency":687,"totalLatency":2122},{"timestamp":"2024-07-12T01-47-15.396Z","query":" Hello.  ","queryLength":9,"language":"en","model":"gpt-4o","llmResponse":"Hi there! How can I assist you with your health or medical care today? ðŸ˜Š","llmResponseLength":73,"transcriptionLatency":534,"llmLatency":-12735,"ttsLatency":687,"totalLatency":-11514},{"timestamp":"2024-07-12T01-47-29.032Z","query":"Are you okay? ","queryLength":14,"language":"en","model":"gpt-4o","llmResponse":"Yes, I'm here and ready to help you. How can I assist you with your health or medical care today? ðŸ˜Š","llmResponseLength":100,"transcriptionLatency":524,"llmLatency":-25943,"ttsLatency":687,"totalLatency":-24732},{"timestamp":"2024-07-12T01-51-38.871Z","query":"Hey. Are you okay?  ","queryLength":20,"language":"en","model":"gpt-4o","llmResponse":"Yes, I'm here and ready to help you. How can I assist you with your health or medical care today? ðŸ˜Š","llmResponseLength":100,"transcriptionLatency":474,"llmLatency":1263,"ttsLatency":790,"totalLatency":2527},{"timestamp":"2024-07-12T01-52-41.992Z","query":"Hola.  Hey. What's up? ","queryLength":23,"language":"en","model":"gpt-4o","llmResponse":"Â¡Hola! Estoy aquÃ­ para ayudarte con cualquier pregunta o preocupaciÃ³n sobre tu salud. Â¿En quÃ© puedo asistirte hoy? ðŸ˜Š","llmResponseLength":117,"transcriptionLatency":119,"llmLatency":1151,"ttsLatency":753,"totalLatency":2023},{"timestamp":"2024-07-12T01-53-32.903Z","query":"Hey. What's up? ","queryLength":16,"language":"en","model":"gpt-4o","llmResponse":"Hello! I'm here to help you with any health or medical care questions you might have. How can I assist you today? ðŸ˜Š","llmResponseLength":116,"transcriptionLatency":389,"llmLatency":1272,"ttsLatency":2651,"totalLatency":4312},{"timestamp":"2024-07-12T01-54-54.172Z","query":"  Hello. Who are you? ","queryLength":22,"language":"en","model":"gpt-4o","llmResponse":"Hello! I'm Meddy, your medical assistant. How can I help you with your health or medical care today? ðŸ˜Š","llmResponseLength":103,"transcriptionLatency":471,"llmLatency":2397,"ttsLatency":811,"totalLatency":3679},{"timestamp":"2024-07-12T01-56-07.319Z","query":"So the other day, I was going fishing, and then my back blew out so I was wondering how can I get can you recommend me a good doctor? For my problem?     ","queryLength":154,"language":"en","model":"gpt-4o","llmResponse":"I'm sorry to hear about your back pain. It's best to consult your primary care doctor for a recommendation. They can refer you to a specialist, like an orthopedic doctor or a physical therapist, who can help with your back issues.","llmResponseLength":230,"transcriptionLatency":113,"llmLatency":1130,"ttsLatency":1030,"totalLatency":2273},{"timestamp":"2024-07-12T01-58-12.121Z","query":" So the other day, I was going camping,   And then This big grizzly bear. I Found it.  ","queryLength":87,"language":"en","model":"gpt-4o","llmResponse":"Wow, that sounds intense! I hope you're okay. If you have any health concerns or need medical advice after such an encounter, please let me know how I can assist you.","llmResponseLength":166,"transcriptionLatency":233,"llmLatency":1108,"ttsLatency":1008,"totalLatency":2349},{"timestamp":"2024-07-12T01-59-35.384Z","query":"","queryLength":0,"language":"undefined","model":"gpt-4o","llmResponse":"That sounds like an adventure! Did something happen during your camping trip that you'd like to talk about?","llmResponseLength":107,"transcriptionLatency":null,"llmLatency":null,"ttsLatency":708,"totalLatency":null},{"timestamp":"2024-07-12T01-59-47.662Z","query":" So the other day, I was going camping and this huge grizzly bear just attacking    Bro, that's not what I want. ","queryLength":113,"language":"en","model":"gpt-4o","llmResponse":"I'm really sorry to hear that. That must have been terrifying. Are you okay? Do you need help with any injuries or health concerns from the encounter?","llmResponseLength":150,"transcriptionLatency":112,"llmLatency":794,"ttsLatency":816,"totalLatency":1722},{"timestamp":"2024-07-12T02-09-14.169Z","query":"","queryLength":0,"language":"undefined","model":"gpt-4o","llmResponse":"That sounds like quite an adventure! What happened during your camping trip?","llmResponseLength":76,"transcriptionLatency":null,"llmLatency":null,"ttsLatency":631,"totalLatency":null},{"timestamp":"2024-07-12T02-09-23.172Z","query":" So the other day, I went camping. And we ran into a huge grizzly bear.   Oh, come on.","queryLength":86,"language":"en","model":"gpt-4o","llmResponse":"That sounds really scary! Are you okay? Did you or anyone else get hurt? How can I assist you with any health concerns you might have?","llmResponseLength":134,"transcriptionLatency":226,"llmLatency":1058,"ttsLatency":1218,"totalLatency":2502},{"timestamp":"2024-07-12T02-10-19.444Z","query":"  So ","queryLength":5,"language":"en","model":"gpt-4o","llmResponse":"It seems like your message got cut off. How can I assist you with your health or medical care today? ðŸ˜Š","llmResponseLength":103,"transcriptionLatency":440,"llmLatency":826,"ttsLatency":675,"totalLatency":1941},{"timestamp":"2024-07-12T02-11-04.839Z","query":"","queryLength":0,"language":"undefined","model":"gpt-4o","llmResponse":"That sounds like a lovely time! Did you enjoy the fishing? How can I assist you with your health today?","llmResponseLength":103,"transcriptionLatency":null,"llmLatency":null,"ttsLatency":715,"totalLatency":null},{"timestamp":"2024-07-12T02-11-09.057Z","query":" So the other day, I went camping  And we were just fishing and all of a sudden, we turn around   ","queryLength":98,"language":"en","model":"gpt-4o","llmResponse":"That sounds like quite an experience! What happened next? Are you okay? Do you need any help with health concerns from that trip?","llmResponseLength":129,"transcriptionLatency":76,"llmLatency":991,"ttsLatency":819,"totalLatency":1886},{"timestamp":"2024-07-12T02-12-09.007Z","query":"","queryLength":0,"language":"undefined","model":"gpt-4o","llmResponse":"\"Camping and fishing, sounds fun.\"","llmResponseLength":34,"transcriptionLatency":null,"llmLatency":null,"ttsLatency":585,"totalLatency":null},{"timestamp":"2024-07-12T02-12-21.985Z","query":"So the other day, I was going camping and we were fishing And all of a sudden, I turned around and    Okay. Actually, this is a bad example. Right? ","queryLength":148,"language":"en","model":"gpt-4o","llmResponse":"No worries! If you have any health or medical care questions, feel free to ask. I'm here to help you with whatever you need. ðŸ˜Š","llmResponseLength":127,"transcriptionLatency":77,"llmLatency":790,"ttsLatency":928,"totalLatency":1795},{"timestamp":"2024-07-12T02-17-13.335Z","query":"","queryLength":0,"language":"undefined","model":"gpt-4o","llmResponse":"\"Worried about something, I see.\"","llmResponseLength":33,"transcriptionLatency":null,"llmLatency":null,"ttsLatency":563,"totalLatency":null},{"timestamp":"2024-07-12T02-17-51.540Z","query":" Hey, Mehdi. So I'm a little bit worried about my  Hypertension, Could you tell me       The fuck.                   Worried about something I see?      ","queryLength":153,"language":"en","model":"gpt-4o","llmResponse":"I'm sorry to hear you're worried about your hypertension. It's important to manage it well. Have you been taking your medications as prescribed? Do you need help understanding your treatment plan or any lifestyle changes?","llmResponseLength":221,"transcriptionLatency":76,"llmLatency":974,"ttsLatency":831,"totalLatency":1881},{"timestamp":"2024-07-12T02-22-06.331Z","query":"","queryLength":0,"language":"undefined","model":"gpt-4o","llmResponse":"\"Hypertension can be a serious concern. That must be worrying for you.\"","llmResponseLength":71,"transcriptionLatency":null,"llmLatency":null,"ttsLatency":707,"totalLatency":null},{"timestamp":"2024-07-12T02-22-21.457Z","query":" So the other day, I went to my doctor He said  I may have hypertension.  So I'm very worried about that.   Yes. Yes. It is.    ","queryLength":128,"language":"en","model":"gpt-4o","llmResponse":"I understand that can be worrying. Hypertension, or high blood pressure, is common and manageable. Have you been given any specific instructions or medications? I'm here to help you understand them better.","llmResponseLength":205,"transcriptionLatency":111,"llmLatency":1491,"ttsLatency":1029,"totalLatency":2631},{"timestamp":"2024-07-12T02-23-31.214Z","query":"","queryLength":0,"language":"undefined","model":"gpt-4o","llmResponse":"Receiving a hypertension diagnosis can be quite concerning.","llmResponseLength":59,"transcriptionLatency":null,"llmLatency":null,"ttsLatency":614,"totalLatency":null},{"timestamp":"2024-07-12T02-23-40.581Z","query":"So the other day, I went to my doctor, and I found out I have hypertension. So I'm very worried about that.   Yes. It is quick, sir. Thank ","queryLength":139,"language":"en","model":"gpt-4o","llmResponse":"I'm sorry to hear that. It's natural to feel worried. Hypertension can be managed with lifestyle changes and medication. Have you been given any specific instructions or medications? I'm here to help you understand them better.","llmResponseLength":227,"transcriptionLatency":89,"llmLatency":846,"ttsLatency":823,"totalLatency":1758}];
function createChart(canvasId, data, title, yAxisLabel) {
	new Chart(document.getElementById(canvasId), {
		type: "line",
		data: data,
		options: {
			responsive: true,
			plugins: {
				title: {
					display: true,
					text: title,
				},
			},
			scales: {
				y: {
					beginAtZero: true,
					title: {
						display: true,
						text: yAxisLabel,
					},
				},
				x: {
					type: "linear",
					title: {
						display: true,
						text: "Data Point",
					},
					ticks: {
						stepSize: 1,
						callback: function (value, index, values) {
							return index + 1;
						},
					},
				},
			},
		},
	});
}

function getRandomColor() {
	return `hsl(${Math.random() * 360}, 100%, 50%)`;
}

function prepareChartData(logData, valueKey, separateBy = "model") {
	const categories = [...new Set(logData.map((log) => log[separateBy]))];
	return {
		labels: logData.map((_, index) => index + 1),
		datasets: categories.map((category) => ({
			label: category,
			data: logData
				.filter((log) => log[separateBy] === category)
				.map((log, index) => ({ x: index + 1, y: log[valueKey] })),
			fill: false,
			borderColor: getRandomColor(),
			tension: 0.1,
		})),
	};
}

function createLatencyCharts() {
	const latencyTypes = [
		{
			key: "transcriptionLatency",
			title:
				"Time Between Last Audio Chunk from Client and End of Transcription",
			id: "timeLastAudioToEndTranscriptionChart",
		},
		{
			key: "llmLatency",
			title: "Time from End of Transcription to First LLM Chunk",
			id: "timeEndTranscriptionToFirstLLMChart",
		},
		{
			key: "ttsLatency",
			title: "Time from First LLM Chunk to First Audio Chunk from TTS",
			id: "timeFirstLLMToFirstAudioTTSChart",
			separateByLanguage: true,
		},
		{
			key: "totalLatency",
			title: "Total Time to First Audio from TTS",
			id: "totalTimeToFirstAudioTTSChart",
			separateByLanguage: true,
		},
	];

	latencyTypes.forEach((type) => {
		const data = prepareChartData(
			logData,
			type.key,
			type.separateByLanguage ? "language" : "model"
		);
		createChart(type.id, data, type.title, "Time (ms)");
	});
}

function createQueryLengthChart() {
	const data = prepareChartData(logData, "queryLength");
	createChart("queryLengthChart", data, "Query Length per Model", "Length");
}

function createResponseLengthChart() {
	const data = prepareChartData(logData, "llmResponseLength");
	createChart(
		"responseLengthChart",
		data,
		"Response Length per Model",
		"Length"
	);
}

function createLanguageChart() {
	const languages = [...new Set(logData.map((log) => log.language))];
	const data = {
		labels: languages,
		datasets: [
			{
				data: languages.map(
					(lang) => logData.filter((log) => log.language === lang).length
				),
				backgroundColor: languages.map(() => getRandomColor()),
			},
		],
	};
	new Chart(document.getElementById("languageChart"), {
		type: "pie",
		data: data,
		options: {
			responsive: true,
			plugins: {
				title: {
					display: true,
					text: "Query Language Distribution",
				},
				legend: {
					position: "top",
				},
			},
		},
	});
}

function populateTable() {
	const table = document.getElementById("logTable");
	const headers = [
		"Timestamp",
		"Model",
		"Query",
		"Query Length",
		"Language",
		"LLM Response",
		"LLM Response Length",
		"Time between last audio chunk and end of transcription",
		"Time between end of transcription and first llm chunk",
		"Time between end of first llm chunk and first audio chunk from TTS",
		"Total time to get first audio chunk from TTS after getting last audio chunk from client",
	];
	const headerRow = table.insertRow();
	headers.forEach((header) => {
		const th = document.createElement("th");
		th.textContent = header;
		headerRow.appendChild(th);
	});
	logData.forEach((log) => {
		const row = table.insertRow();
		headers.forEach((header) => {
			const cell = row.insertCell();
			let value;
			switch (header) {
				case "Timestamp":
					value = log.timestamp;
					break;
				case "Model":
					value = log.model;
					break;
				case "Query":
					value = log.transcript;
					break;
				case "Query Length":
					value = log.transcript?.length;
					break;
				case "Language":
					value = log.lang;
					break;
				case "LLM Response":
					value = log.llmResponse;
					break;
				case "LLM Response Length":
					value = log.llmResponse?.length;
					break;
				case "Time between last audio chunk and end of transcription":
					value = log.endTranscription - log.lastAudioChunkFromClient;
					break;
				case "Time between end of transcription and first llm chunk":
					value = log.firstLLMChunk - log.endTranscription;
					break;
				case "Time between end of first llm chunk and first audio chunk from TTS":
					value = log.firstAudioChunkFromTTS - log.firstLLMChunk;
					break;
				case "Total time to get first audio chunk from TTS after getting last audio chunk from client":
					value = log.firstAudioChunkFromTTS - log.lastAudioChunkFromClient;
					break;
				default:
					value = "N/A";
			}
			cell.textContent =
				value !== undefined
					? typeof value === "number"
						? value + " ms"
						: value
					: "N/A";
		});
	});
}

createLatencyCharts();
createQueryLengthChart();
createResponseLengthChart();
// createLanguageChart();
// populateTable();
